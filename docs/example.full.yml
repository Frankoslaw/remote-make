version: "1.0"
metadata:
  name: "Example Workflow"
  description: "Demo of improved schema"

backends:
  discord-notifier:
    backend: "discord"
    config:
      webhook_url: "https://discord.com/api/webhooks/â€¦"
  docker-provisioner:
    backend: "docker"
    config:
      docker_host: "unix:///var/run/docker.sock"
  libvirt-provisioner:
    backend: "libvirt"
    config:
      uri: "qemu:///system"
  aws-provisioner:
    backend: "aws"
    config:
      region: "us-west-2"
      access_key: "your-access-key"
      secret_key: "your-secret-key"

workers:
  local-worker:
    type: local
  docker-worker:
    type: docker
    config:
      image: "alpine:latest"
  libvirt-worker:
    type: libvirt
    config:
      cpus: 2
      memory: 2048
      disk_size: 20G
  aws-worker:
    type: aws
    config:
      instance_type: "t2.micro"
      ami_id: "ami-12345678"
      region: "us-west-2"

tasks:
  - tag: "Test Task"
    worker: local-worker
    is_atomic: true
    is_concurrent: false
    steps:
      - type: process
        backend: posix
        cmd: "echo 'Hello, World!'"
      - type: task
        worker: local-worker
        steps:
          - type: process
            backend: posix
            cmd: "echo 'Hello from nested task!'"
          - tag: nested-complete
            type: process
            backend: posix
            cmd: "echo 'This is another step in the nested task!'"
      - type: notify
        backend: discord-notifier
        message: "Task completed successfully: {{ nested-complete.exit-code }}"